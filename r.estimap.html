<h2>DESCRIPTION</h2>

<em>r.estimap</em> is an implementation of the ESTIMAP recreation algorithm
to support mapping and modelling of ecosystem services (Zulian, 2014).

<p>
The algorithm
estimates the capacity of ecosystems to provide opportunities
for nature-based recreation
and leisure
(recreation opportunity spectrum).

First,
it bases upon look-up tables,
to score access to or the quality
of natural features
(land suitability, protected areas, infrastructure, water resources)
for their potential to support for outdoor recreation
(potential recreation).

Second,
it implements a proximity-remoteness concept
to integrate
the recreation potential
and the existing infrastructure.

<h5>Terminology</h5>

First, an overview of the terminology

<dl>
  <dt> Recreation Potential</dt>
  <dd> is ... </dd>
  <dt> Recreation Opportunity</dt>
  <dd> is ... </dd>
  <dt> Recreation (Opportunity) Spectrum</dt>
  <dd> is ... </dd>
  <dt> Demand Distribution</dt>
  <dd> is ... </dd>
  <dt> Unmet Demand Distribution</dt>
  <dd> is ... </dd>
  <dt> Mobidtty</dt>
  <dd> is ... </dd>
  <dt> Flow</dt>
  <dd> is ... </dd>
  <dt> Supply</dt>
  <dd> is ... </dd>
  <dt> Use</dt>
  <dd> is ... </dd>
</dl>

<h5>Recreation Potential</h5>

<p>
The recreation potential map,
derives by adding and normalizing
maps of natural <i>components</i>
that may provide recreation opportunities.

Components are user defined, pre-processed, input raster maps,
that score access to or quality of resources such as:

<ul>
  <li> land</li>
  <li> natural</li>
  <li> water</li>
  <li> urban</li>
</ul>

<p>
Alternatively,
the module treats unprocessed maps,
by providing a set of relevant scores or coefficients,
to derive component maps required by the algorithm.
For example,
a CORINE land cover map
may be given to the 'landuse' input option
along with a set of land suitability scores,
that correspond to the CORINE nomenclature.
The latter is fed as an ASCII file
to the 'suitability_scores' input option.

<h5>Recreation Opportunity</h5>

<p>
...

<h5>Recreation Spectrum</h5>

<p>
The recreation (opportunity) spectrum map,
derives by combining the recreation potential
and maps that depict access (i.e. infrastructure) and/or
areas that provide opportunities for recreational activities.

<p>
<strong>Explain here</strong>
significance of areas with the
<em>Highest Recreation Spectrum</em>.

<p>
<div class="code"><pre>
    |-------------------------+------+----------+-----|
    | Potential / Opportunity | Near | Midrange | Far |
    |-------------------------+------+----------+-----|
    | Near                    | 1    | 2        | 3   |
    |-------------------------+------+----------+-----|
    | Midrange                | 4    | 5        | 6   |
    |-------------------------+------+----------+-----|
    | Far                     | 7    | 8        | 9   |
    |-------------------------+------+----------+-----|
</pre></div>

<h5>Flow, Supply and Use</h5>

<p>
By integrating
maps of
regions of interest
and population,
the module
supports the production of
a series of
<i>demand</i>
and <i>mobility</i> maps
as well as exporting
related <i>supply</i> and <i>use</i> tables.

<h3>Mathematical Background</h3>

<p>
The following equation represents the logic behind ESTIMAP:
<pre>
Recreation <strong>Spectrum</strong> = Recreation <strong>Potential</strong> + Recreation <strong>Opportunity</strong>
</pre>

<h5>Remoteness and Proximity</h5>

The base
<em>distance</em>
function
to quantify
<em>attractiveness</em>, is:

<div class="code"><pre>
( {Constant} + {Kappa} ) / ( {Kappa} + exp({alpha} * {Variable}) )
</pre></div>

where

<ul>
  <li>Constant</li>
  <li>Coefficients
    <ul>
      <li>Kappa</li>
      <li>Alpha</li>
    </ul>
  </li>
  <li>Variable</li>
</ul>

<h5>Accessibility</h5>

<h5>Normalization</h5>

Each <em>component</em> is normalized.

That is,
all maps listed in a given component
are summed up and normalised.
Normalizing any raster map,
be it a single map
or the sum of a series of maps,
is performed by
subtracting its minimum value
and dividing by its range.

<h2>EXAMPLES</h2>

For the sake of demonstrating the usage of the module,
we use the following "component" maps
<ul>
  <li><pre>land_suitability</pre></li>
  <li><pre>water_resources</pre></li>
  <li><pre>protected_areas</pre></li>
</ul>
(available to download at: ...) 
to derive a recreation <i>potential</i> map.

<p>
<div>
<center>
  <img src="area_of_interest.png" alt="Example of a land suitability input map">
  <img src="land_suitability.png" alt="Example of a land suitability input map">
  <img src="water_resources.png" alt="Example of a water resources input map">
  <img src="protected_areas.png" alt="Example of a protected areas input map">
</center>
</div>


Before anything, we need to define the extent of interest using
<div class="code"><pre>
g.region raster=area_of_interest
</pre></div>


<h3>Using pre-processed maps</h3>

The first four options are meant for pre-processed input maps
that classify as either
<code>land</code>,
<code>natural</code>,
<code>water</code>
and <code>infrastructure</code>
resources.

<h4>Potential</h4>

<p>
A simple call is to use a map that depicts the suitability of
different land types to support for recreation:

<div class="code"><pre>
r.estimap  land=land_suitability  potential=potential
</pre></div>

<p>
<center>
<img src="potential.png" alt="Example of a recreation potential output map">
</center>

Note,
this will process the input map
<code>land_suitability</code>
over the extent defined previously via
<code>g.region</code>.

<p>
To exclude certain areas from the
computations, we may use a raster map as a mask:

<div class="code"><pre>
r.estimap  land=land_suitability  mask=area_of_interest  potential=potential_1
</pre></div>

<p>
<center>
<img src="potential_1.png" alt="Example of a recreation potential output map while using a MASK">
</center>

The use of a mask
(in GRASS GIS' terminology known as <strong>MASK</strong>)
will ignore areas of <strong>No Data</strong>
(pixels in the
<code>area_of_interest</code>
map assigned the NULL value).
Successively,
these areas will be empty in the output map
<code>potential_1</code>.

Actually,
the same effect can be achieved
by using GRASS GIS' native mask creation module `r.mask`
and feed it with a raster map of interest.
The result will be a raster map named <strong>MASK</strong>
whose presence acts as a filter.

In the following examples,
it becomes obvious that
if a single input map
features such <strong>No Data</strong> areas,
they will be propagated in the output map.

<p>
However, it is good practice to use a MASK
when one needs to ensure
the exclusion of undesired areas
from any computations.

Also,
note the `--o` flag:
it is required to overwrite
the already existing map named
<code>potential_1</code>.

Next, we add a water component and execute again, without a mask:

<div class="code"><pre>
r.estimap  land=land_suitability  water=water_resources  potential=potential_2
</pre></div>

<p>
<center>
<img src="potential_2.png" alt="Example of a recreation potential output map while using a MASK, a land suitability map and a water resources map">
</center>

In addition, we provide a map of protected areas and repeat:

<div class="code"><pre>
r.estimap  land=land_suitability  water=water_resources  natural=protected_areas  potential=potential_3
</pre></div>

<p>
<center>
<img src="potential_3.png" alt="Example of a recreation potential output map
while using a MASK, a land suitability map, a water resources map and a natural
resources map">
</center>

While the <code>land</code> option
accepts only one map as an input,
both the <code>water</code> and the <code>natural</code> options
accept multiple maps as inputs.

In example,
we add a second map of
<code>bathing_water_quality</code>
to the water component:
<div class="code"><pre>
r.estimap  land=land_suitability  water=water_resources,bathing_water_quality  natural=protected_areas  potential=potential_4
</pre></div>

<p>
In general, arbitrary number of maps,
separated by comma,
may be added to options that accept multiple inputs.

<p>
<center>
<img src="potential_4.png" alt="Example of a recreation potential output map
while using a MASK, a land suitability map, two water resources maps and a natural
resources map">
</center>

<p>
This example, features also a title and a legend, so as to make sense of the
map.

<div class="code"><pre>
d.rast  potential_4
d.legend  -c  -b  potential_4  at=0,15,0,1  border_color=white
d.text  text="Potential"  bgcolor=white
</pre></div>


The output maps
<code>potential_1</code>,
<code>potential_2</code>,
<code>potential_3</code>
and <code>potential_4</code>
range within [0,3].
Yet, they differ in the distribution of values
due to the different set of input maps.

<p>
All of the above examples
base upon pre-processed maps
that score the access to and quality of
land, water and natural resources.

For using <i>raw</i>, unprocessed maps,
read section <b>Using unprocessed maps</b>.

<h4>Spectrum</h4>

To derive a map
with the recreation (opportunity)
<code>spectrum</code>,
we need in addition an
<code>infrastructure</code>
component:

<div class="code"><pre>
r.estimap  \
  land=land_suitability \
  water=water_resources,bathing_water_quality \
  natural=protected_areas \
  spectrum=spectrum  \
  infrastructure=distance_to_infrastructure
</pre></div>

<p>
<center>
<img src="spectrum.png" alt="Example of a recreation spectrum output map
while using a MASK, a land suitability map, a water resources map and a natural
resources map">
</center>

Missing to define the
<code>infrastructure</code> map,
the command will abort and inform about.

<p>
The image above, was produced via the following native GRASS GIS commands
<div class="code"><pre>
d.rast  spectrum
d.legend  -c  -b  spectrum  at=0,30,0,1  border_color=white
d.text  text="Spectrum"  bgcolor=white
</pre></div>

<h5>Opportunity</h5>

The <code>opportunity</code> map
is actually an intermediate step
of the algorithm.
The option to output this map
is meant for expert users
who want to explore
the fundamentals of the processing steps.
Hence,
it requires to define
the <code>spectrum</code>
map as well.

Building upon the previous command, we add the <code>opportunity</code> output
option:

<div class="code"><pre>
r.estimap  \
  land=land_suitability \
  water=water_resources,bathing_water_quality \
  natural=protected_areas \
  spectrum=spectrum  \
  infrastructure=distance_to_infrastructure
  opportunity=opportunity \
</pre></div>

<p>
<center>
<img src="opportunity.png" alt="Example of a recreation spectrum output map
while using a MASK, a land suitability map, a water resources map and a natural
resources map">
</center>


<h4>More input maps</h4>

To derive
the <code>demand</code> distributiom,
the <code>unmet</code> demand distributiom
and the <code>mobility</code>,
additional requirements are
a population map
and one of regions
within which to aggregate
estimations of expected numbers of visits.

<p>
Population
<center>
<img src="population_2015.png" alt="Fragment of a population map (GHSL, 2015)">
</center>

<p>
Local administrative units
<center>
<img src="local_administrative_units.png" alt="Fragment of a local administrative units input map">
</center>

<h4>Demand</h4>

<div class="code"><pre>
r.estimap --o \
  mask=area_of_interest \
  land=land_suitability \
  water=water_resources,bathing_water_quality \
  natural=protected_areas \
  infrastructure=distance_to_infrastructure \
  demand=demand \
  population=population_2015 \
  base=local_administrative_units
</pre></div>

<p>
<center>
<img src="demand.png" alt="Example of a demand distribution output map while using
a MASK
and inputs for
land suitability,
water resources,
natural resources,
infrastructure,
population
and base">
</center>

<h4>Unmet Demand</h4>

<div class="code"><pre>
r.estimap --o \
  mask=area_of_interest \
  land=land_suitability \
  water=water_resources,bathing_water_quality \
  natural=protected_areas \
  infrastructure=distance_to_infrastructure \
  unmet=unmet_demand \
  population=population_2015 \
  base=local_administrative_units
</pre></div>

<p>
<center>
<img src="unmet_demand.png" alt="Example of an 'unmet demand' output map while using
a MASK
and inputs for
land suitability,
water resources,
natural resources,
infrastructure,
population
and base">
</center>

<h4>Mobility</h4>

<p>
The
<i>mobility</i>
bases upon the same function
used to quantify the attractiveness
of locations for their recreational value.
It includes an extra
<em>score</em>
term.

<p>
The computation involves a
<em>distance</em> map,
reclassified in 5 categories
as shown in the following table.

For each distance category,
a unique pair of coefficient values
is assigned to the basic equation.

<div class="tg-wrap"><table>
  <tr>
    <th>Distance</th>
    <th>Kappa</th>
    <th>Alpha</th>
  </tr>
  <tr>
    <td>0 to 1</td>
    <td>0.02350</td>
    <td>0.00102</td>
  </tr>
  <tr>
    <td>1 to 2</td>
    <td>0.02651</td>
    <td>0.00109</td>
  </tr>
  <tr>
    <td>2 to 3</td>
    <td>0.05120</td>
    <td>0.00098</td>
  </tr>
  <tr>
    <td>3 to 4</td>
    <td>0.10700</td>
    <td>0.00067</td>
  </tr>
  <tr>
    <td>&gt;4</td>
    <td>0.06930</td>
    <td>0.00057</td>
  </tr>
</table></div>

<p>
Note, the last distance category is not considered in deriving the final "map
of visits".

The output is essentially
a raster map
with the distribution of the demand
per distance category and within predefined geometric boundaries

<p>
<div class="code"><pre>
r.estimap --o \
  mask=area_of_interest \
  land=land_suitability \
  water=water_resources,bathing_water_quality \
  natural=protected_areas \
  infrastructure=distance_to_infrastructure \
  mobility=mobility \
  population=population_2015 \
  base=local_administrative_units
</pre></div>

<p>
<center>
<img src="mobility.png" alt="Example of a mobility output map while using
a MASK
and inputs for
land suitability,
water resources,
natural resources,
infrastructure,
population
and base">
</center>

<h4>All in one call</h4>

Of course it is possible to derive all output maps with one call:
<div class="code"><pre>
r.estimap --o  \
  mask=area_of_interest  \
  land=land_suitability  \
  water=water_resources,bathing_water_quality  \
  natural=protected_areas  \
  infrastructure=distance_to_infrastructure  \
  potential=potential  \
  opportunity=opportunity  \
  spectrum=spectrum  \
  demand=demand  \
  unmet=unmet_demand  \
  mobility=mobility  \
  population=population_2015  \
  base=local_administrative_units
  timestamp='2018'
</pre></div>

<p>
Note the use of
the <code>timestamp</code>
parameter!
This concerns the <code>spectrum</code> map.
If plans
include working with GRASS GIS' temporal framework
on time-series,
this will be useful.

<h3>Using unprocessed input maps</h3>

<p>
The module
offers a pre-processing functionality
for all of the following input components:

<ul>
  <li>landuse</li>
  <li>suitability_scores</li>
</ul>
<ul>
  <li>landcover</li>
  <li>land_classes</li>
</ul>
<ul>
  <li>lakes</li>
  <li>lakes_coefficients</li>
  <li>default is set to: euclidean,1,30,0.008,1</li>
</ul>
<ul>
  <li>coastline</li>
  <li>coastline_coefficients</li>
  <li>default is set to: euclidean,1,30,0.008,1</li>
  <li>coast_geomorphology</li>
</ul>
<ul>
  <li>bathing_water</li>
  <li>bathing_coefficients</li>
  <li>default is set to: euclidean,1,5,0.01101</li>
</ul>
<ul>
  <li>protected</li>
  <li>protected_scores</li>
  <li>11:11:0,12:12:0.6,2:2:0.8,3:3:0.6,4:4:0.6,5:5:1,6:6:0.8,7:7:0,8:8:0,9:9:0</li>
</ul>
<ul>
  <li>anthropic</li>
  <li>anthropic_distances</li>
  <li>0:500:1,500.000001:1000:2,1000.000001:5000:3,5000.000001:10000:4,10000.00001:*:5</li>
</ul>
<ul>
  <li>roads</li>
  <li>roads_distances</li>
  <li>0:500:1,500.000001:1000:2,1000.000001:5000:3,5000.000001:10000:4,10000.00001:*:5</li>
</ul>

<p>
A first look on how this works,
is to experiment with
the <code>landuse</code>
and <code>suitability_scores</code>
input options.

<p>
Let's return to the first example, and use a fragment from the unprocessed
CORINE land data set, instead of the <code>land_suitability</code> map. This
requires a set of "score" rules, that correspond to the CORINE nomenclature, to
translate the land cover types into recreation potential.

<p>
<div>
  <center>
  <img src="corine_land_cover_2006.png" alt="Fragment from the CORINE land data base ">
  <img src="corine_land_cover_legend.png" alt="Legend for the CORINE land data base">
  </center>
</div>

<p>
In this case,
the rules are a simple ASCII file
(for example named <code>corine_suitability.scores</code>
that contains the following

<div class="code"><pre>
1:1:0:0
2:2:0.1:0.1
3:9:0:0
10:10:1:1
11:11:0.1:0.1
12:13:0.3:0.3
14:14:0.4:0.4
15:17:0.5:0.5
18:18:0.6:0.6
19:20:0.3:0.3
21:22:0.6:0.6
23:23:1:1
24:24:0.8:0.8
25:25:1:1
26:29:0.8:0.8
30:30:1:1
31:31:0.8:0.8
32:32:0.7:0.7
33:33:0:0
34:34:0.8:0.8
35:35:1:1
36:36:0.8:0.8
37:37:1:1
38:38:0.8:0.8
39:39:1:1
40:42:1:1
43:43:0.8:0.8
44:44:1:1
45:45:0.3:0.3
</pre></div>

This file is provided in the <code>suitability_scores</code> option:

<div class="code"><pre>
r.estimap  landuse=corine_land_cover_2006 suitability_scores=corine_suitability.scores  potential=potential_corine --o
</pre></div>

<p>
<center>
<img src="potential_corine.png" alt="Example of a recreation spectrum output map
while using a MASK, based on a fragment from the CORINE land data base">
</center>

The same can be achieved with a long one-line string too:

<div class="code"><pre>
r.estimap \
  landuse=corine_land_cover_2006 \
  suitability_scores="1:1:0:0,2:2:0.1:0.1,3:9:0:0,10:10:1:1,11:11:0.1:0.1,12:13:0.3:0.3,14:14:0.4:0.4,15:17:0.5:0.5,18:18:0.6:0.6,19:20:0.3:0.3,21:22:0.6:0.6,23:23:1:1,24:24:0.8:0.8,25:25:1:1,26:29:0.8:0.8,30:30:1:1,31:31:0.8:0.8,32:32:0.7:0.7,33:33:0:0,34:34:0.8:0.8,35:35:1:1,36:36:0.8:0.8,37:37:1:1,38:38:0.8:0.8,39:39:1:1,40:42:1:1,43:43:0.8:0.8,44:44:1:1,45:45:0.3:0.3"  potential=potential_1 --o
</pre></div>

In fact,
this very scoring scheme,
for CORINE land data sets,
is integrated in the module,
so we obtain the same output
even by discarding the <code>suitability_scores</code> option:

<div class="code"><pre>
r.estimap  landuse=corine_land_cover_2006  suitability_scores=corine_suitability.scores  potential=potential_1 --o
</pre></div>

This is so
because CORINE is a standard choice
among existing land data bases
that cover european territories.

In case of a user requirement to provide an alternative scoring scheme, all
what is required is either of

<ul>
  <li>provide a new "rules" file with the desired set of scoring rules</li>
  <li>provide a string to the <code>suitability_scores</code> option</li>
</ul>

<h2>REFERENCES</h2>

<ul>
  <li>http://publications.jrc.ec.europa.eu/repository/bitstream/JRC87585/lb-na-26474-en-n.pd</li>
</ul>

<h2>SEE ALSO</h2>

<em>
<a href="r.univar.html">r.univar</a>,
<a href="r.mapcalc.html">r.mapcalc</a>
</em>


<h2>AUTHOR</h2>

Nikos Alexandris

<p><i>Last changed: $Date: 2017-11-03 18:21:39 +0100 (Fri, 03 Nov 2017) $</i>
