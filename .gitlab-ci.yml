image: ubuntu

variables:
    DEBIAN_FRONTEND: noninteractive

pages:
  script:

  # insall dependencies
  - apt-get update -qq && apt-get install -y -qq grass grass-dev grass-doc wget

  # some files are not installed properly, get them online
  - wget https://grass.osgeo.org/grass74/manuals/grass_logo.png -P /usr/lib/grass74/docs/html/
  - wget https://grass.osgeo.org/grass74/manuals/grassdocs.css -P /usr/lib/grass74/docs/html/

  # create a temporary location (needed for v<7.6)
  - grass -c EPSG:4326 grassdb_temporary -e

  # compile using g.extension from current directory to build directory
  # expecting name of module is repository name
  - grass grassdb_temporary/PERMANENT --exec g.extension extension=${CI_PROJECT_NAME} url=. prefix=build --verbose

  # put the compile documentation to the public directory
  # public name is convention for published web pages
  - cp -r build/docs/html public

  # create a page after the repository|module's name
  - cp public/${CI_PROJECT_NAME}.html public/index.html

  artifacts:
    paths:
    # mark the directory for preservation
    - public

  only:
  - master
